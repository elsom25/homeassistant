- id: '1609713837113'
  alias: Light Mode - Manual
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.light_mode_dropdown
    to: Manual
  condition: []
  action:
  - service: homeassistant.turn_off
    data: {}
    target:
      entity_id:
      - switch.adaptive_lighting_overhead
      - switch.adaptive_lighting_lamps
  mode: restart
- id: '1624735000543'
  alias: Light Mode - Sleep
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.light_mode_dropdown
    to: Sleep
  condition: []
  action:
  - service: homeassistant.turn_on
    data: {}
    target:
      entity_id:
      - switch.adaptive_lighting_overhead
      - switch.adaptive_lighting_lamps
  - service: homeassistant.turn_on
    target:
      entity_id:
      - switch.adaptive_lighting_sleep_mode_overhead
      - switch.adaptive_lighting_sleep_mode_lamps
  mode: restart
- id: '1624735357292'
  alias: Light Mode - Sun
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.light_mode_dropdown
    to: Sun
  condition: []
  action:
  - service: homeassistant.turn_on
    data: {}
    target:
      entity_id:
      - switch.adaptive_lighting_overhead
      - switch.adaptive_lighting_lamps
  - service: homeassistant.turn_off
    target:
      entity_id:
      - switch.adaptive_lighting_sleep_mode_overhead
      - switch.adaptive_lighting_sleep_mode_lamps
  mode: restart
- id: '1652830381918'
  alias: Litter Robot — Timed Clean
  description: ''
  trigger:
  - platform: time
    at: 07:30:00
  - platform: time
    at: '22:00:00'
  condition: []
  action:
  - service: script.reset_and_cycle_litter
    data: {}
  mode: restart
- id: '1671567664532'
  alias: 'Noficiation: Water leak'
  description: Send a notification if a water leak is ever detected.
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.boiler_water_leak_xs_sensor_water_leak_detected
    to: 'on'
  - platform: state
    entity_id:
    - input_button.test_notifications
  - platform: state
    entity_id:
    - binary_sensor.cellar_cooler_water_leak_sensor_water_leak_detected
    - binary_sensor.hot_water_heater_water_leak_sensor_water_leak_detected
    - binary_sensor.storage_stairs_water_leak_sensor_water_leak_detected
    to: 'on'
  - platform: state
    entity_id:
    - binary_sensor.cellar_cooler_water_leak_detected
    to: 'on'
  - platform: state
    entity_id:
    - binary_sensor.hot_water_heater_leak_detected
    to: 'on'
  - platform: state
    entity_id:
    - binary_sensor.storage_stairs_water_leak_detected
    to: 'on'
  condition: []
  action:
  - service: notify.notify
    data:
      title: There's a water leak!
      message: '{{ trigger.to_state.name }} has detected water.'
      data:
        push:
          sound:
            name: default
            critical: 1
            volume: 1
  mode: single
- id: '1671571619287'
  alias: 'Notification: Door open when leaving '
  description: Send an alert if any door is open when we leave the house.
  trigger:
  - platform: state
    entity_id:
    - sensor.home_status
    to: Away
  - platform: state
    entity_id:
    - input_button.test_notifications
  condition:
  - condition: or
    conditions:
    - type: is_open
      condition: device
      device_id: a8db82cda3c5bdb3f740f053cfb36084
      entity_id: binary_sensor.front_door_open
      domain: binary_sensor
    - type: is_open
      condition: device
      device_id: d6c416ace546657017936758a806cb03
      entity_id: binary_sensor.studio_door_open
      domain: binary_sensor
    - condition: device
      device_id: 5830e65a30312842915a1690e06ce05b
      domain: cover
      entity_id: cover.studio_garage_door
      type: is_open
  action:
  - service: notify.notify
    data:
      title: Door left open!
      message: One of our doors was left open.
      data:
        push:
          sound:
            name: default
            critical: 1
            volume: 1
  mode: single
- id: '1671572503313'
  alias: 'Notification: Door opened while away'
  description: Send a notification if a door is opened while we're away.
  trigger:
  - platform: state
    entity_id:
    - input_button.test_notifications
  - platform: state
    entity_id:
    - lock.front_door
    to: unlocked
  - platform: state
    entity_id:
    - lock.studio_door
    to: unlocked
  - platform: state
    entity_id:
    - cover.studio_garage_door
    to: opening
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: sensor.home_status
      state: Away
    - condition: state
      entity_id: sensor.home_status
      state: Extended Away
  action:
  - service: notify.notify
    data:
      title: Someone unlocked a door
      message: '{{ trigger.to_state.name }} has changed to {{ trigger.to_state.state
        }} at {{ now().strftime(''%X'') }}.'
  mode: single
- id: '1699127481758'
  alias: Start Sunrise Alarm Based on Day
  description: ''
  trigger:
  - platform: time
    at: input_datetime.sunrise_start_weekdays
  - platform: time
    at: input_datetime.sunrise_start_weekends
  condition:
  - condition: state
    entity_id: input_boolean.sunrise_alarm
    state: 'on'
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
      - condition: template
        value_template: '{{ now().strftime(''%H:%M:%S'') == states(''input_datetime.sunrise_start_weekdays'')[0:8]
          }}'
    - condition: and
      conditions:
      - condition: time
        weekday:
        - sat
        - sun
      - condition: template
        value_template: '{{ now().strftime(''%H:%M:%S'') == states(''input_datetime.sunrise_start_weekends'')[0:8]
          }}'
  action:
  - service: script.sunrise_alarm
    data: {}
  mode: single
- id: '1758484397009'
  alias: Assist – Duck all playing speakers (run-start)
  triggers:
  - event_type: assist_pipeline
    event_data:
      type: run-start
    trigger: event
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ targets | length > 0 }}'
      sequence:
      - data:
          scene_id: pre_assist_music_{{ run_id }}
          snapshot_entities: '{{ targets }}'
        action: scene.create
      - delay: '00:00:00.10'
      - repeat:
          for_each: '{{ targets }}'
          sequence:
          - variables:
              current: '{{ state_attr(repeat.item,''volume_level'') | float(0.4) }}'
              new_vol: '{{ (current * duck_factor) | round(3) | min(1) | max(0.02)
                }}'
          - target:
              entity_id: '{{ repeat.item }}'
            data:
              volume_level: '{{ new_vol }}'
            action: media_player.volume_set
  mode: restart
  variables:
    run_id: '{{ trigger.event.data.run_id }}'
    players: "{{ states.media_player\n   | selectattr('state','in',['playing','buffering'])\n
      \  | map(attribute='entity_id') | list }}\n"
    duck_factor: 0.4
    excluded: []
    targets: "{{ players\n   | reject('in', excluded)\n   | list }}\n"
- id: '1758484516060'
  alias: Assist – Restore speakers (run-end)
  triggers:
  - event_type: assist_pipeline
    event_data:
      type: run-end
    trigger: event
  actions:
  - target:
      entity_id: scene.pre_assist_music_{{ run_id }}
    action: scene.turn_on
  mode: restart
  variables:
    run_id: '{{ trigger.event.data.run_id }}'
